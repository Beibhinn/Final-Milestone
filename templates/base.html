{% load staticfiles %}
{% load avatar_tags %}
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Unicorn Atrractor</title>
    <link rel="shortcut icon" type="image/x-icon" href="https://img.icons8.com/plasticine/50/000000/unicorn.png">

    <!-- Custom fonts for this template-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/8b6167d561.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://kit-free.fontawesome.com/releases/latest/css/free.min.css" media="all">
    <link rel="stylesheet" href="https://kit-free.fontawesome.com/releases/latest/css/free-v4-font-face.min.css"
          media="all">
    <link rel="stylesheet" href="https://kit-free.fontawesome.com/releases/latest/css/free-v4-shims.min.css"
          media="all">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
          rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="{% static 'css/sb-admin-2.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/custom.css' %}" rel="stylesheet">

</head>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

        <!-- Sidebar - Brand -->
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'index' %}">
            <div class="sidebar-brand-icon rotate-n-15">
                <img src="https://img.icons8.com/plasticine/50/000000/unicorn.png">
            </div>
            <div class="sidebar-brand-text mx-3">Unicorn Attractor</div>
        </a>

        <!-- Divider -->
        <hr class="sidebar-divider my-0">

        <!-- Nav Item - Dashboard -->
        <li class="nav-item active">
            <a class="nav-link" href="/">
                <i class="fas fa-fw fa-tachometer-alt"></i>
                <span>Issue Dashboard</span></a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider">

        <!-- Heading -->
        <div class="sidebar-heading">
            Issues
        </div>

        <!-- Nav Item - Bugs Collapse Menu -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseBugs"
               aria-expanded="true" aria-controls="collapseBugs">
                <i class="fas fa-fw fa-bug"></i>
                <span>Bugs</span>
            </a>
            <div id="collapseBugs" class="collapse" aria-labelledby="headingBugs" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <h6 class="collapse-header">Bug Options:</h6>
                    <a class="collapse-item" href="{% url 'bugs' %}">View bugs</a>
                    <a class="collapse-item" href="{% url 'new_bug' %}">Add a bug</a>
                </div>
            </div>
        </li>

        <!-- Nav Item - Features Collapse Menu -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseFeatures"
               aria-expanded="true" aria-controls="collapseFeatures">
                <i class="fas fa-fw fa-magic"></i>
                <span>Features</span>
            </a>
            <div id="collapseFeatures" class="collapse" aria-labelledby="headingFeatures"
                 data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <h6 class="collapse-header">Feature Options:</h6>
                    <a class="collapse-item" href="{% url 'features' %}">View features</a>
                    <a class="collapse-item" href="{% url 'new_feature' %}">Add a feature</a>
                </div>
            </div>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider">

        <!-- Heading -->
        <div class="sidebar-heading">
            Extras
        </div>

        <!-- Nav Item - Extras Collapse Menu -->
        <li class="nav-item">
            <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseAccount"
               aria-expanded="true" aria-controls="collapseAccount">
                <i class="fas fa-fw fa-folder"></i>
                <span>Account</span>
            </a>
            <div id="collapseAccount" class="collapse" aria-labelledby="headingAccount" data-parent="#accordionSidebar">
                <div class="bg-white py-2 collapse-inner rounded">
                    <h6 class="collapse-header">Account Access:</h6>
                    {% if user.is_authenticated %}
                        <a class="collapse-item" href="{% url 'profile' %}">Profile</a>
                        <a class="collapse-item" href="{% url 'logout' %}">Logout</a>
                    {% else %}
                        <a class="collapse-item" href="{% url 'login' %}">Login</a>
                        <a class="collapse-item" href="{% url 'register' %}">Register</a>
                    {% endif %}
                    <div class="collapse-divider"></div>
                    <h6 class="collapse-header">Other Pages:</h6>
                    <a class="collapse-item" href="{% url 'view_cart' %}">Shopping cart</a>
                </div>
            </div>
        </li>

        <!-- Nav Item - Charts -->
        <li class="nav-item">
            <a class="nav-link" href="{% url 'charts' %}">
                <i class="fas fa-fw fa-chart-area"></i>
                <span>Charts</span></a>
        </li>

        <!-- Nav Item - About us -->
        <li class="nav-item">
            <a class="nav-link" href="{% url 'about' %}">
                <i class="fas fa-fw fa-question"></i>
                <span>About us</span></a>
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider d-none d-md-block">

        <!-- Sidebar Toggler (Sidebar) -->
        <div class="text-center d-none d-md-inline">
            <button class="rounded-circle border-0" id="sidebarToggle"></button>
        </div>

    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <!-- Topbar -->
            <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                <!-- Sidebar Toggle (Topbar) -->
                <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                    <i class="fa fa-bars"></i>
                </button>

                <!-- Topbar Search -->
                <form class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search"
                      action="{% url 'search' %}" method="GET">
                    <div class="input-group">
                        <input type="text" class="form-control bg-light border-0 small" name="search_term"
                               placeholder="Search" aria-label="Search" aria-describedby="basic-addon2">
                        <div class="input-group-append">
                            <button class="btn btn-main" type="submit">
                                <i class="fas fa-search fa-sm"></i>
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Topbar Navbar -->
                <ul class="navbar-nav ml-auto">

                    <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                    <li class="nav-item dropdown no-arrow d-sm-none">
                        <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <!-- Dropdown -->
                        <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                             aria-labelledby="searchDropdown">
                            <form class="form-inline mr-auto w-100 navbar-search">
                                <div class="input-group">
                                    <input type="text" class="form-control bg-light border-0 small" name="search_term"
                                           placeholder="Search" aria-label="Search" aria-describedby="basic-addon2">
                                    <div class="input-group-append">
                                        <button class="btn btn-primary" type="button">
                                            <i class="fas fa-search fa-sm"></i>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </li>

                    <!-- Nav Item - Cart -->
                    <li class="nav-item dropdown no-arrow mx-1">
                        <a class="nav-link dropdown-toggle" href="#" id="cartDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-fw fa-shopping-cart"></i>
                            <!-- Counter - Cart -->
                            {% if feature_count > 0 %}
                                <span class="badge badge-danger badge-counter">{{ feature_count }}</span>
                            {% endif %}
                        </a>
                        <!-- Dropdown - Messages -->
                        <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                             aria-labelledby="cartDropdown">
                            <h6 class="dropdown-header">
                                {% if user_is.authenticated %}
                                    {{ user }}'s cart
                                {% else %}
                                    My cart
                                {% endif %}
                            </h6>
                            {% if cart_items %}
                                {% for item in cart_items %}
                                    <a class="dropdown-item d-flex align-items-center"
                                       href="{% url 'feature_detail' item.feature.id %}">
                                    {% if item.feature.image %}
                                        <div class="dropdown-list-image mr-3">
                                            <img class="rounded-circle" src="/media/{{ item.feature.image }}" alt="">
                                        </div>
                                    {% endif %}
                                    <div class="font-weight-bold">
                                        <div class="text-truncate">{{ item.feature.name }}</div>
                                        <div class="small text-gray-500">Donation: € {{ item.donation_amount }}</div>
                                    </div>
                                {% endfor %}
                            </a>
                            {% else %}
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="font-weight-bold">
                                        <div>Looks like you haven't got anything in your basket just yet. Please feel
                                            free to donate to any feature(s) you'd most like to see implemented
                                        </div>
                                    </div>
                                </a>
                            {% endif %}
                            <a class="dropdown-item text-center small text-gray-500" href="{% url 'view_cart' %}">View
                                cart</a>
                        </div>
                    </li>

                    <div class="topbar-divider d-none d-sm-block"></div>

                    <!-- Nav Item - User Information -->
                    {% if user.is_authenticated %}
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="mr-2 d-none d-lg-inline text-gray-600 small">{{ user.username }}</span>
                                {% avatar user class="img-profile rounded-circle" id="user_avatar" %}
                            </a>
                            <!-- Dropdown - User Information -->
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                 aria-labelledby="userDropdown">
                                <a class="dropdown-item" href="{% url 'profile' %}">
                                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Profile
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="{% url 'logout' %}">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Logout
                                </a>
                            </div>
                        </li>
                    {% else %}
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="guestDropdown" role="button"
                               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="mr-2 d-none d-lg-inline text-gray-600 small">Guest</span>
                                <img class="img-profile rounded-circle"
                                     src="https://cdn0.iconfinder.com/data/icons/unigrid-flat-human-vol-2/90/011_101_anonymous_anonym_hacker_vendetta_user_human_avatar-512.png"
                                     style="height: 2rem; width: 2rem">
                            </a>
                            <!-- Dropdown - Guest Information -->
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                 aria-labelledby="guestDropdown">
                                <a class="dropdown-item" href="{% url 'login' %}">
                                    <i class="fas fa-sign-in-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Log in
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="{% url 'register' %}">
                                    <i class="fas fa-user-plus fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Register
                                </a>
                            </div>
                        </li>
                    {% endif %}
                </ul>

            </nav>
            <!-- End of Topbar -->

            <!-- Begin Page Content -->
            <div class="container-fluid">

                <div class="row">
                    {% if messages %}
                        <div class="alert alert-success">
                            <div class="messages">
                                {% for message in messages %}
                                    {{ message }}
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                    <div class="container-fluid">
                        {% block content %} {% endblock %}
                    </div>
                </div>

            </div>
        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
            <div class="container my-auto">
                <div class="copyright text-center my-auto">
                    <span>© <img alt="unicorn attractor logo"
                                 src="https://img.icons8.com/plasticine/25/000000/unicorn.png"> Unicorn Attractor</span>
                    <br>
                    <span><a href="https://icons8.com/icon/101728/color-hand-drawn">Color Hand Drawn icon by Icons8</a></span>
                    <hr>
                    <span>Source code on <a href="https://github.com/Beibhinn/Final-Milestone" target="_blank"><i
                            class="fab fa-github"></i> GitHub</a>. Deployed on Heroku.</span>
                </div>
            </div>
        </footer>
        <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>


<!-- Bootstrap core JavaScript-->
<script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

<!-- Core plugin JavaScript-->
<script src="{% static 'vendor/jquery-easing/jquery.easing.min.js' %}"></script>

<!-- Custom scripts for all pages-->
<script src="{% static 'js/sb-admin-2.min.js' %}"></script>

<!-- Page level plugins -->
<script src="{% static 'vendor/chart.js/Chart.min.js' %}"></script>


<script src="https://kit.fontawesome.com/8b6167d561.js" crossorigin="anonymous"></script>

{% block head_js %}
{% endblock head_js %}

{% csrf_token %}
<script>
    // https://docs.djangoproject.com/en/2.2/ref/csrf/#setting-the-token-on-the-ajax-request
    const csrfToken = jQuery("[name=csrfmiddlewaretoken]").val();

    {# Drag and drop funcationality #}
    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        ev.dataTransfer.setData("text", ev.target.id);
        console.log(ev.target);
    }

    $(".draggable").hover(
        function () {
            $(this).css("cursor", "grab");
        }, function () {
            $(this).css("cursor", "default");
        }
    );
    $(".draggable").mousedown(
        function () {
            $(this).css("cursor", "grabbing");
        }
    );
    $(".draggable").mouseup(
        function () {
            $(this).css("cursor", "grab");
        }
    );


    function drop(ev) {
        ev.preventDefault();
        const data = ev.dataTransfer.getData("text");
        const container = ev.target.closest(".status-container");
        container.appendChild(document.getElementById(data));
        const id = data.split('-', 2);

        $.ajax({
            url: `${id[0]}s/update_status/`,
            type: 'post',
            data: JSON.stringify({
                id: id[1],
                status: container.getAttribute('data-status')
            }),
            headers: {
                "X-CSRFToken": csrfToken
            },
            dataType: 'json',
            success: (data, status) => {
                window.location.reload();
            }
        });
    }

    {# Upvoting functionality #}

    function toggleUpvote(id) {
        $.ajax({
          url: "https://{{ request.get_host }}/bugs/toggle_upvote/",
            type: 'post',
            data: JSON.stringify({
                id: id,
            }),
            headers: {
                "X-CSRFToken": csrfToken
            },
            dataType: 'json',
            success: function () {
                $(`#bug-upvote-${id}`).load(location.href + ` [data-bug-id=${id}]`);
                $(`#bug-detail-${id}`).load(location.href + ` #bug-detail-upvote-${id}`);
            }
        });
        $(`div[data-bug-id=${id}]`).find('.fa-arrow-alt-circle-up').toggleClass("fas").toggleClass("far");
    }
</script>

{% block page_script %}
{% endblock %}

{% block avatar_change_script %}
{% endblock %}


</body>

</html>
